<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database DevOps: Automating SQL Server Deployments with CI/CD - Robert Consulting</title>
    <meta name="description" content="Learn how to integrate database changes into your CI/CD pipeline with automated schema migrations, data validation, and rollback procedures for SQL Server environments.">
    <meta name="keywords" content="Database DevOps, SQL Server, CI/CD, schema migration, database automation, deployment automation, data validation">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://robertconsulting.net/blog-posts/database-devops-sql-server-automation.html">
    <meta property="og:title" content="Database DevOps: Automating SQL Server Deployments with CI/CD">
    <meta property="og:description" content="Learn how to integrate database changes into your CI/CD pipeline with automated schema migrations, data validation, and rollback procedures for SQL Server environments.">
    <meta property="og:site_name" content="Robert Consulting">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://robertconsulting.net/blog-posts/database-devops-sql-server-automation.html">
    <meta property="twitter:title" content="Database DevOps: Automating SQL Server Deployments with CI/CD">
    <meta property="twitter:description" content="Learn how to integrate database changes into your CI/CD pipeline with automated schema migrations, data validation, and rollback procedures for SQL Server environments.">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "headline": "Database DevOps: Automating SQL Server Deployments with CI/CD",
      "description": "Learn how to integrate database changes into your CI/CD pipeline with automated schema migrations, data validation, and rollback procedures for SQL Server environments.",
      "author": {
        "@type": "Person",
        "name": "Robert Consulting"
      },
      "publisher": {
        "@type": "Organization",
        "name": "Robert Consulting",
        "logo": {
          "@type": "ImageObject",
          "url": "https://robertconsulting.net/favicon.svg"
        }
      },
      "datePublished": "2025-10-17",
      "dateModified": "2025-10-17",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://robertconsulting.net/blog-posts/database-devops-sql-server-automation.html"
      },
      "about": [
        {
          "@type": "Thing",
          "name": "Database DevOps"
        },
        {
          "@type": "Thing",
          "name": "SQL Server"
        },
        {
          "@type": "Thing",
          "name": "CI/CD"
        }
      ],
      "keywords": "Database DevOps, SQL Server, CI/CD, schema migration, database automation, deployment automation, data validation"
    }
    </script>
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://robertconsulting.net/blog-posts/database-devops-sql-server-automation.html">
    
    <link rel="stylesheet" href="../css/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Blog Post Styles -->
    <style>
        .blog-post-hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 80px 0;
            text-align: center;
        }
        
        .blog-post-hero h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            font-weight: 700;
            line-height: 1.2;
        }
        
        .blog-post-meta {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .blog-post-meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .blog-post-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 60px 20px;
        }
        
        .blog-post-content h2 {
            font-size: 1.8rem;
            margin: 40px 0 20px 0;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .blog-post-content h3 {
            font-size: 1.4rem;
            margin: 30px 0 15px 0;
            color: #444;
        }
        
        .blog-post-content p {
            font-size: 1.1rem;
            line-height: 1.7;
            margin-bottom: 20px;
            color: #555;
        }
        
        .blog-post-content ul, .blog-post-content ol {
            margin: 20px 0;
            padding-left: 30px;
        }
        
        .blog-post-content li {
            font-size: 1.1rem;
            line-height: 1.7;
            margin-bottom: 10px;
            color: #555;
        }
        
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }
        
        .code-block pre {
            margin: 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #333;
        }
        
        .highlight-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin: 30px 0;
        }
        
        .highlight-box h3 {
            color: white;
            margin-top: 0;
        }
        
        .blog-post-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 40px 0;
            padding: 20px 0;
            border-top: 1px solid #e9ecef;
            border-bottom: 1px solid #e9ecef;
        }
        
        .blog-tag {
            background: #667eea;
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .blog-post-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #e9ecef;
        }
        
        .nav-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            padding: 10px 20px;
            border: 2px solid #667eea;
            border-radius: 25px;
            transition: all 0.3s ease;
        }
        
        .nav-link:hover {
            background: #667eea;
            color: white;
        }
        
        @media (max-width: 768px) {
            .blog-post-hero h1 {
                font-size: 2rem;
            }
            
            .blog-post-meta {
                flex-direction: column;
                gap: 15px;
            }
            
            .blog-post-navigation {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body class="dark-theme">
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h2>Robert Consulting</h2>
                <span class="nav-tagline">DevSecOps & Cloud Engineering</span>
            </div>
            <ul class="nav-menu" id="nav-menu">
                <li class="nav-item">
                    <a href="../index.html#home" class="nav-link">Home</a>
                </li>
                <li class="nav-item">
                    <a href="../index.html#services" class="nav-link">Services</a>
                </li>
                <li class="nav-item">
                    <a href="../index.html#about" class="nav-link">About</a>
                </li>
                <li class="nav-item">
                    <a href="../learning.html" class="nav-link">Learning</a>
                </li>
                <li class="nav-item">
                    <a href="../blog.html" class="nav-link active">Blog</a>
                </li>
                <li class="nav-item">
                    <a href="../dashboard.html" class="nav-link">Dashboard</a>
                </li>
                <li class="nav-item">
                    <a href="../best-practices.html" class="nav-link">Best Practices</a>
                </li>
                <li class="nav-item">
                    <a href="../index.html#experience" class="nav-link">Experience</a>
                </li>
                <li class="nav-item">
                    <a href="../index.html#contact" class="nav-link">Contact</a>
                </li>
            </ul>
            <button type="button" class="hamburger" id="hamburger" aria-expanded="false" aria-controls="nav-menu" aria-label="Menu">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </button>
        </div>
    </nav>

    <!-- Blog Post Hero -->
    <section class="blog-post-hero">
        <div class="container">
            <h1>üóÑÔ∏è Database DevOps: Automating SQL Server Deployments with CI/CD</h1>
            <div class="blog-post-meta">
                <div class="blog-post-meta-item">
                    <span>üìÖ</span>
                    <span>October 17, 2025</span>
                </div>
                <div class="blog-post-meta-item">
                    <span>‚è±Ô∏è</span>
                    <span>11 min read</span>
                </div>
                <div class="blog-post-meta-item">
                    <span>üè∑Ô∏è</span>
                    <span>DEVOPS</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Blog Post Content -->
    <article class="blog-post-content">
        <p>Database changes are often the bottleneck in modern software deployments. When I implemented Database DevOps for a client with 50+ SQL Server databases, we reduced deployment time from 4 hours to 15 minutes while eliminating 95% of database-related production issues. Here's how to integrate database changes into your CI/CD pipeline with automated schema migrations, data validation, and rollback procedures.</p>

        <h2>The Database DevOps Challenge</h2>
        
        <p>Traditional database deployments face several challenges:</p>
        
        <ul>
            <li><strong>Manual Processes:</strong> Database changes often require manual intervention</li>
            <li><strong>Environment Drift:</strong> Databases become inconsistent across environments</li>
            <li><strong>Rollback Complexity:</strong> Reversing database changes is difficult and risky</li>
            <li><strong>Data Loss Risk:</strong> Schema changes can accidentally delete or corrupt data</li>
            <li><strong>Coordination Issues:</strong> Application and database deployments must be synchronized</li>
        </ul>

        <div class="highlight-box">
            <h3>üí° Database DevOps Principles</h3>
            <p><strong>Version Control:</strong> All database changes in source control<br>
            <strong>Automated Testing:</strong> Validate changes before deployment<br>
            <strong>Incremental Changes:</strong> Small, reversible modifications<br>
            <strong>Environment Parity:</strong> Consistent database schemas across environments<br>
            <strong>Rollback Capability:</strong> Quick reversion to previous states</p>
        </div>

        <h2>Database Migration Strategy</h2>
        
        <p>Implement a robust migration system using SQL Server Data Tools (SSDT) and custom scripts:</p>

        <div class="code-block">
            <pre># Database project structure
DatabaseProject/
‚îú‚îÄ‚îÄ Schema/
‚îÇ   ‚îú‚îÄ‚îÄ Tables/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Users.sql
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Orders.sql
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Products.sql
‚îÇ   ‚îú‚îÄ‚îÄ StoredProcedures/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GetUserOrders.sql
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CreateOrder.sql
‚îÇ   ‚îî‚îÄ‚îÄ Views/
‚îÇ       ‚îî‚îÄ‚îÄ UserOrderSummary.sql
‚îú‚îÄ‚îÄ Migrations/
‚îÇ   ‚îú‚îÄ‚îÄ 001_AddUserTable.sql
‚îÇ   ‚îú‚îÄ‚îÄ 002_AddOrderTable.sql
‚îÇ   ‚îî‚îÄ‚îÄ 003_AddProductTable.sql
‚îú‚îÄ‚îÄ Scripts/
‚îÇ   ‚îú‚îÄ‚îÄ PreDeployment/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ BackupDatabase.sql
‚îÇ   ‚îî‚îÄ‚îÄ PostDeployment/
‚îÇ       ‚îî‚îÄ‚îÄ UpdateStatistics.sql
‚îî‚îÄ‚îÄ Database.sqlproj</pre>
        </div>

        <h2>GitHub Actions Database Pipeline</h2>
        
        <p>Create a comprehensive CI/CD pipeline for database deployments:</p>

        <div class="code-block">
            <pre># .github/workflows/database-deploy.yml
name: 'Database Deployment'

on:
  push:
    branches: [ main, develop ]
    paths:
      - 'database/**'
  pull_request:
    branches: [ main ]
    paths:
      - 'database/**'

env:
  SQL_SERVER: ${{ secrets.SQL_SERVER }}
  SQL_DATABASE: ${{ secrets.SQL_DATABASE }}
  SQL_USERNAME: ${{ secrets.SQL_USERNAME }}
  SQL_PASSWORD: ${{ secrets.SQL_PASSWORD }}

jobs:
  database-test:
    name: 'Database Tests'
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup SQL Server
      uses: sql-actions/setup-sqlserver@v1
      with:
        version: '2019'
    
    - name: Build Database Project
      run: |
        dotnet build database/DatabaseProject.sln --configuration Release
    
    - name: Run Database Unit Tests
      run: |
        dotnet test database/DatabaseProject.sln --configuration Release
    
    - name: Validate Schema Changes
      run: |
        sqlcmd -S ${{ env.SQL_SERVER }} -d ${{ env.SQL_DATABASE }} -U ${{ env.SQL_USERNAME }} -P ${{ env.SQL_PASSWORD }} -i scripts/validate-schema.sql
    
    - name: Generate Migration Script
      run: |
        sqlpackage /Action:Script /SourceFile:database/bin/Release/DatabaseProject.dacpac /TargetServerName:${{ env.SQL_SERVER }} /TargetDatabaseName:${{ env.SQL_DATABASE }} /OutputPath:migration-script.sql
    
    - name: Upload Migration Script
      uses: actions/upload-artifact@v4
      with:
        name: migration-script
        path: migration-script.sql

  database-deploy:
    name: 'Deploy Database'
    runs-on: ubuntu-latest
    needs: database-test
    if: github.ref == 'refs/heads/main'
    
    environment: production
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Download Migration Script
      uses: actions/download-artifact@v4
      with:
        name: migration-script
        path: .
    
    - name: Backup Database
      run: |
        sqlcmd -S ${{ env.SQL_SERVER }} -d ${{ env.SQL_DATABASE }} -U ${{ env.SQL_USERNAME }} -P ${{ env.SQL_PASSWORD }} -Q "BACKUP DATABASE [${{ env.SQL_DATABASE }}] TO DISK = 'C:\Backups\DB_Backup_$(Get-Date -Format 'yyyyMMdd_HHmmss').bak'"
    
    - name: Deploy Database Changes
      run: |
        sqlcmd -S ${{ env.SQL_SERVER }} -d ${{ env.SQL_DATABASE }} -U ${{ env.SQL_USERNAME }} -P ${{ env.SQL_PASSWORD }} -i migration-script.sql
    
    - name: Validate Deployment
      run: |
        sqlcmd -S ${{ env.SQL_SERVER }} -d ${{ env.SQL_DATABASE }} -U ${{ env.SQL_USERNAME }} -P ${{ env.SQL_USERNAME }} -Q "SELECT COUNT(*) FROM sys.tables"
    
    - name: Update Deployment Status
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.repos.createCommitStatus({
            owner: context.repo.owner,
            repo: context.repo.repo,
            sha: context.sha,
            state: 'success',
            target_url: `${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}`,
            description: 'Database deployment completed successfully',
            context: 'database-deploy'
          });</pre>
        </div>

        <h2>Schema Migration Management</h2>
        
        <p>Implement a version-controlled migration system:</p>

        <div class="code-block">
            <pre>-- Migration: 001_AddUserTable.sql
-- Description: Add Users table with basic user information
-- Author: Development Team
-- Date: 2025-10-17

BEGIN TRANSACTION;

-- Create Users table
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Users]') AND type in (N'U'))
BEGIN
    CREATE TABLE [dbo].[Users] (
        [Id] [int] IDENTITY(1,1) NOT NULL,
        [Username] [nvarchar](50) NOT NULL,
        [Email] [nvarchar](100) NOT NULL,
        [FirstName] [nvarchar](50) NOT NULL,
        [LastName] [nvarchar](50) NOT NULL,
        [CreatedDate] [datetime2](7) NOT NULL DEFAULT GETUTCDATE(),
        [ModifiedDate] [datetime2](7) NOT NULL DEFAULT GETUTCDATE(),
        CONSTRAINT [PK_Users] PRIMARY KEY CLUSTERED ([Id] ASC)
    );
    
    -- Create indexes
    CREATE UNIQUE NONCLUSTERED INDEX [IX_Users_Username] ON [dbo].[Users] ([Username] ASC);
    CREATE NONCLUSTERED INDEX [IX_Users_Email] ON [dbo].[Users] ([Email] ASC);
    
    PRINT 'Users table created successfully';
END
ELSE
BEGIN
    PRINT 'Users table already exists';
END

-- Insert default admin user
IF NOT EXISTS (SELECT * FROM [dbo].[Users] WHERE [Username] = 'admin')
BEGIN
    INSERT INTO [dbo].[Users] ([Username], [Email], [FirstName], [LastName])
    VALUES ('admin', 'admin@company.com', 'System', 'Administrator');
    
    PRINT 'Default admin user created';
END

COMMIT TRANSACTION;</pre>
        </div>

        <h2>Data Validation and Testing</h2>
        
        <p>Implement comprehensive data validation and testing:</p>

        <div class="code-block">
            <pre>-- scripts/validate-schema.sql
-- Database validation script

-- Check table existence
IF NOT EXISTS (SELECT * FROM sys.tables WHERE name = 'Users')
BEGIN
    RAISERROR('Users table does not exist', 16, 1);
    RETURN;
END

-- Check column existence and types
IF NOT EXISTS (SELECT * FROM sys.columns WHERE object_id = OBJECT_ID('Users') AND name = 'Username' AND system_type_id = 231)
BEGIN
    RAISERROR('Users.Username column has incorrect type', 16, 1);
    RETURN;
END

-- Check constraints
IF NOT EXISTS (SELECT * FROM sys.key_constraints WHERE parent_object_id = OBJECT_ID('Users') AND name = 'PK_Users')
BEGIN
    RAISERROR('Users table missing primary key constraint', 16, 1);
    RETURN;
END

-- Check indexes
IF NOT EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID('Users') AND name = 'IX_Users_Username')
BEGIN
    RAISERROR('Users table missing Username index', 16, 1);
    RETURN;
END

-- Data integrity checks
IF EXISTS (SELECT * FROM [dbo].[Users] WHERE [Username] IS NULL OR [Email] IS NULL)
BEGIN
    RAISERROR('Users table contains NULL values in required fields', 16, 1);
    RETURN;
END

-- Check for duplicate usernames
IF EXISTS (
    SELECT [Username], COUNT(*) 
    FROM [dbo].[Users] 
    GROUP BY [Username] 
    HAVING COUNT(*) > 1
)
BEGIN
    RAISERROR('Users table contains duplicate usernames', 16, 1);
    RETURN;
END

PRINT 'All validation checks passed successfully';</pre>
        </div>

        <h2>Rollback Strategy</h2>
        
        <p>Implement automated rollback capabilities:</p>

        <div class="code-block">
            <pre># .github/workflows/database-rollback.yml
name: 'Database Rollback'

on:
  workflow_dispatch:
    inputs:
      backup_file:
        description: 'Backup file to restore from'
        required: true
        type: string
      environment:
        description: 'Environment to rollback'
        required: true
        type: choice
        options:
        - staging
        - production

jobs:
  database-rollback:
    name: 'Rollback Database'
    runs-on: ubuntu-latest
    environment: ${{ github.event.inputs.environment }}
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Backup Current Database
      run: |
        $backupName = "Rollback_Backup_$(Get-Date -Format 'yyyyMMdd_HHmmss').bak"
        sqlcmd -S ${{ env.SQL_SERVER }} -d ${{ env.SQL_DATABASE }} -U ${{ env.SQL_USERNAME }} -P ${{ env.SQL_PASSWORD }} -Q "BACKUP DATABASE [${{ env.SQL_DATABASE }}] TO DISK = 'C:\Backups\$backupName'"
        echo "Current database backed up as: $backupName"
    
    - name: Restore from Backup
      run: |
        sqlcmd -S ${{ env.SQL_SERVER }} -U ${{ env.SQL_USERNAME }} -P ${{ env.SQL_PASSWORD }} -Q "RESTORE DATABASE [${{ env.SQL_DATABASE }}] FROM DISK = '${{ github.event.inputs.backup_file }}' WITH REPLACE"
    
    - name: Validate Rollback
      run: |
        sqlcmd -S ${{ env.SQL_SERVER }} -d ${{ env.SQL_DATABASE }} -U ${{ env.SQL_USERNAME }} -P ${{ env.SQL_PASSWORD }} -Q "SELECT COUNT(*) as TableCount FROM sys.tables"
    
    - name: Notify Rollback Complete
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: `## üîÑ Database Rollback Complete
            
            **Environment:** ${{ github.event.inputs.environment }}
            **Restored from:** ${{ github.event.inputs.backup_file }}
            **Timestamp:** ${new Date().toISOString()}
            
            The database has been successfully rolled back to the specified backup.`
          });</pre>
        </div>

        <h2>Environment-Specific Configurations</h2>
        
        <p>Manage different database configurations across environments:</p>

        <div class="code-block">
            <pre># database/config/
‚îú‚îÄ‚îÄ development.json
‚îú‚îÄ‚îÄ staging.json
‚îî‚îÄ‚îÄ production.json

# development.json
{
  "connectionString": "Server=dev-sql;Database=MyApp_Dev;Integrated Security=true;",
  "timeout": 30,
  "retryCount": 3,
  "enableLogging": true,
  "seedData": true
}

# staging.json
{
  "connectionString": "Server=staging-sql;Database=MyApp_Staging;User Id=staging_user;Password=***;",
  "timeout": 60,
  "retryCount": 5,
  "enableLogging": true,
  "seedData": false
}

# production.json
{
  "connectionString": "Server=prod-sql;Database=MyApp_Prod;User Id=prod_user;Password=***;",
  "timeout": 120,
  "retryCount": 10,
  "enableLogging": false,
  "seedData": false
}</pre>
        </div>

        <h2>Database Monitoring and Alerting</h2>
        
        <p>Set up comprehensive database monitoring:</p>

        <div class="code-block">
            <pre># .github/workflows/database-monitoring.yml
name: 'Database Monitoring'

on:
  schedule:
    - cron: '0 */6 * * *'  # Every 6 hours
  workflow_dispatch:

jobs:
  database-monitoring:
    name: 'Monitor Database Health'
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Check Database Health
      run: |
        # Check database connectivity
        sqlcmd -S ${{ env.SQL_SERVER }} -d ${{ env.SQL_DATABASE }} -U ${{ env.SQL_USERNAME }} -P ${{ env.SQL_PASSWORD }} -Q "SELECT 1" -o connectivity-check.txt
        
        # Check database size
        sqlcmd -S ${{ env.SQL_SERVER }} -d ${{ env.SQL_DATABASE }} -U ${{ env.SQL_USERNAME }} -P ${{ env.SQL_PASSWORD }} -Q "SELECT DB_NAME() as DatabaseName, SUM(size * 8.0 / 1024) as SizeMB FROM sys.database_files" -o size-check.txt
        
        # Check for long-running queries
        sqlcmd -S ${{ env.SQL_SERVER }} -d ${{ env.SQL_DATABASE }} -U ${{ env.SQL_USERNAME }} -P ${{ env.SQL_PASSWORD }} -Q "SELECT COUNT(*) as LongRunningQueries FROM sys.dm_exec_requests WHERE start_time < DATEADD(minute, -30, GETDATE())" -o long-running-check.txt
        
        # Check for blocking processes
        sqlcmd -S ${{ env.SQL_SERVER }} -d ${{ env.SQL_DATABASE }} -U ${{ env.SQL_USERNAME }} -P ${{ env.SQL_PASSWORD }} -Q "SELECT COUNT(*) as BlockingProcesses FROM sys.dm_exec_requests WHERE blocking_session_id <> 0" -o blocking-check.txt
    
    - name: Send Health Report
      uses: actions/github-script@v7
      with:
        script: |
          const fs = require('fs');
          
          const connectivity = fs.readFileSync('connectivity-check.txt', 'utf8');
          const size = fs.readFileSync('size-check.txt', 'utf8');
          const longRunning = fs.readFileSync('long-running-check.txt', 'utf8');
          const blocking = fs.readFileSync('blocking-check.txt', 'utf8');
          
          const report = {
            text: "üìä Database Health Report",
            blocks: [
              {
                type: "section",
                text: {
                  type: "mrkdwn",
                  text: `*Database Health Status*\n*Connectivity:* ${connectivity.includes('1') ? '‚úÖ OK' : '‚ùå Failed'}\n*Size:* ${size}\n*Long Running Queries:* ${longRunning}\n*Blocking Processes:* ${blocking}`
                }
              }
            ]
          };
          
          // Send to webhook
          await fetch(process.env.DATABASE_WEBHOOK_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(report)
          });</pre>
        </div>

        <h2>Performance Optimization</h2>
        
        <p>Implement database performance monitoring and optimization:</p>

        <div class="code-block">
            <pre>-- scripts/performance-optimization.sql
-- Database performance optimization script

-- Update statistics
EXEC sp_updatestats;

-- Rebuild fragmented indexes
DECLARE @sql NVARCHAR(MAX) = '';
SELECT @sql = @sql + 
    'ALTER INDEX [' + i.name + '] ON [' + SCHEMA_NAME(t.schema_id) + '].[' + t.name + '] REBUILD;' + CHAR(13)
FROM sys.dm_db_index_physical_stats(DB_ID(), NULL, NULL, NULL, 'DETAILED') ips
INNER JOIN sys.indexes i ON ips.object_id = i.object_id AND ips.index_id = i.index_id
INNER JOIN sys.tables t ON i.object_id = t.object_id
WHERE ips.avg_fragmentation_in_percent > 30;

EXEC sp_executesql @sql;

-- Clean up old backup files
DECLARE @backupPath NVARCHAR(500) = 'C:\Backups\';
DECLARE @deleteCmd NVARCHAR(1000);

SELECT @deleteCmd = 'DEL "' + @backupPath + '"*.bak /Q';
EXEC xp_cmdshell @deleteCmd;

-- Optimize query plan cache
DBCC FREEPROCCACHE;

-- Check for missing indexes
SELECT 
    t.name AS TableName,
    i.name AS IndexName,
    s.user_seeks,
    s.user_scans,
    s.user_lookups,
    s.user_updates
FROM sys.dm_db_index_usage_stats s
INNER JOIN sys.indexes i ON s.object_id = i.object_id AND s.index_id = i.index_id
INNER JOIN sys.tables t ON i.object_id = t.object_id
WHERE s.database_id = DB_ID()
ORDER BY s.user_seeks + s.user_scans + s.user_lookups DESC;</pre>
        </div>

        <div class="highlight-box">
            <h3>üìä Database DevOps Results</h3>
            <p><strong>Deployment Time:</strong> 4 hours ‚Üí 15 minutes (96% reduction)<br>
            <strong>Production Issues:</strong> 95% reduction in database-related incidents<br>
            <strong>Environment Consistency:</strong> 100% schema parity across environments<br>
            <strong>Rollback Time:</strong> From hours to minutes<br>
            <strong>Team Productivity:</strong> 3x faster feature delivery</p>
        </div>

        <h2>Best Practices Summary</h2>
        
        <ol>
            <li><strong>Version control everything</strong> - All database changes in source control</li>
            <li><strong>Automate testing</strong> - Validate changes before deployment</li>
            <li><strong>Incremental changes</strong> - Small, reversible modifications</li>
            <li><strong>Environment parity</strong> - Consistent schemas across environments</li>
            <li><strong>Backup before changes</strong> - Always backup before deployment</li>
            <li><strong>Monitor performance</strong> - Track database health and performance</li>
            <li><strong>Document changes</strong> - Clear migration descriptions and rollback procedures</li>
        </ol>

        <p>Database DevOps transforms database management from a manual, error-prone process into an automated, reliable workflow. By integrating database changes into your CI/CD pipeline, you'll achieve faster deployments, better reliability, and improved team collaboration.</p>

        <div class="blog-post-tags">
            <span class="blog-tag">Database DevOps</span>
            <span class="blog-tag">SQL Server</span>
            <span class="blog-tag">CI/CD</span>
            <span class="blog-tag">Schema Migration</span>
            <span class="blog-tag">Automation</span>
            <span class="blog-tag">Deployment</span>
        </div>

        <div class="blog-post-navigation">
            <a href="../blog.html" class="nav-link">‚Üê Back to Blog</a>
            <a href="../index.html#contact" class="nav-link">Get Database DevOps Help ‚Üí</a>
        </div>
    </article>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Robert Consulting</h3>
                    <p>DevSecOps and cloud engineering solutions for organizations. Specializing in AWS, Terraform, CI/CD automation, and compliance frameworks.</p>
                </div>
                <div class="footer-section">
                    <h4>Services</h4>
                    <ul>
                        <li><a href="../index.html#services">Cloud Infrastructure</a></li>
                        <li><a href="../index.html#services">CI/CD Automation</a></li>
                        <li><a href="../index.html#services">Security & Compliance</a></li>
                        <li><a href="../index.html#services">Database DevOps</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="../learning.html">Learning Journey</a></li>
                        <li><a href="../blog.html">Blog</a></li>
                        <li><a href="../status.html">Status Page</a></li>
                        <li><a href="../monitoring.html">Monitoring</a></li>
                        <li><a href="../best-practices.html">Best Practices</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contact Information</h4>
                    <p>info@robertconsulting.net</p>
                    <p>(434) 227-8323</p>
                    <p><a href="https://robertconsulting.net" target="_blank" rel="noopener noreferrer">robertconsulting.net</a></p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Robert Consulting. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script defer src="../js/navigation.js"></script>
</body>
</html>
