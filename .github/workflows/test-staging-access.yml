name: Test Staging Access

on:
  workflow_dispatch:
  push:
    branches: [ staging ]
    paths:
      - '.github/workflows/test-staging-access.yml'

jobs:
  test-staging-access:
    name: ðŸ§ª Test Staging Site Access
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ðŸ” Test staging site accessibility
        run: |
          echo "Testing staging site access from GitHub Actions..."
          
          # Test basic connectivity
          if curl -f -s -I "${{ env.STAGING_URL }}" > /dev/null; then
            echo "âœ… Staging site is accessible from GitHub Actions"
            curl -s -I "${{ env.STAGING_URL }}" | head -10
          else
            echo "âŒ Staging site is not accessible from GitHub Actions"
            echo "This might indicate IP restriction issues"
            exit 1
          fi

      - name: ðŸ” Test staging site content
        run: |
          echo "Testing staging site content..."
          
          # Test that we can get the actual content
          CONTENT=$(curl -s "${{ env.STAGING_URL }}")
          if echo "$CONTENT" | grep -q "Robert Consulting"; then
            echo "âœ… Staging site content is accessible"
          else
            echo "âŒ Staging site content is not accessible"
            exit 1
          fi

      - name: ðŸ“Š Test Results Summary
        run: |
          echo "## ðŸ§ª Staging Access Test Results" >> $GITHUB_STEP_SUMMARY
          echo "- **Status**: âœ… Staging site is accessible from GitHub Actions" >> $GITHUB_STEP_SUMMARY
          echo "- **IP Restrictions**: Working correctly - GitHub Actions IPs are allowed" >> $GITHUB_STEP_SUMMARY
          echo "- **Test Time**: $(date -u)" >> $GITHUB_STEP_SUMMARY

env:
  STAGING_URL: 'https://staging.robertconsulting.net'
# Trigger test workflow
