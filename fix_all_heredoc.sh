#!/bin/bash

echo "ðŸ”§ === COMPREHENSIVE HEREDOC FIX SCRIPT ==="
echo "ðŸ“ Fixing all remaining heredoc sections in workflow files..."

# Fix enhanced-issue-management.yml remaining heredoc sections
echo "ðŸ“ Fixing enhanced-issue-management.yml..."

# Replace auto_resolution_comment heredoc
sed -i '/cat > auto_resolution_comment.txt << '\''EOF'\''/,/^EOF$/c\
                echo "ðŸ¤– **Auto-Resolution Check** ðŸ¤–" > auto_resolution_comment.txt\
                echo "" >> auto_resolution_comment.txt\
                echo "I'\''ve detected recent commits that may have resolved this issue:" >> auto_resolution_comment.txt\
                echo "" >> auto_resolution_comment.txt\
                echo "**Recent Activity:**" >> auto_resolution_comment.txt\
                echo "- ðŸ“ Recent commits: $recent_commits" >> auto_resolution_comment.txt\
                echo "- ðŸ” Pattern: ESLint/Lint fixes detected" >> auto_resolution_comment.txt\
                echo "- â° Checked: $(date)" >> auto_resolution_comment.txt\
                echo "" >> auto_resolution_comment.txt\
                echo "**Please verify if this issue has been resolved and close it if so.**" >> auto_resolution_comment.txt\
                echo "" >> auto_resolution_comment.txt\
                echo "**Auto-generated by Enhanced Issue Management System**" >> auto_resolution_comment.txt' .github/workflows/enhanced-issue-management.yml

# Replace stale_issue_comment heredoc
sed -i '/cat > stale_issue_comment.txt << '\''EOF'\''/,/^EOF$/c\
                echo "ðŸ• **Stale Issue Notice** ðŸ•" > stale_issue_comment.txt\
                echo "" >> stale_issue_comment.txt\
                echo "This issue has been inactive for **$days_since_update days** and is marked as low priority." >> stale_issue_comment.txt\
                echo "" >> stale_issue_comment.txt\
                echo "**Options:**" >> stale_issue_comment.txt\
                echo "1. **Close** if no longer relevant" >> stale_issue_comment.txt\
                echo "2. **Update** with current status" >> stale_issue_comment.txt\
                echo "3. **Reassign** if still needed" >> stale_issue_comment.txt\
                echo "" >> stale_issue_comment.txt\
                echo "**Auto-generated by Enhanced Issue Management System**" >> stale_issue_comment.txt' .github/workflows/enhanced-issue-management.yml

echo "âœ… enhanced-issue-management.yml fixed"

# Fix issue-feedback-system.yml remaining heredoc sections
echo "ðŸ“ Fixing issue-feedback-system.yml..."

# Replace critical_update_comment heredoc
sed -i '/cat > critical_update_comment.txt << '\''EOF'\''/,/^EOF$/c\
                  echo "ðŸš¨ **Critical Issue Update Required** ðŸš¨" > critical_update_comment.txt\
                  echo "" >> critical_update_comment.txt\
                  echo "This **CRITICAL** issue hasn'\''t been updated in **$hours_since_update hours**:" >> critical_update_comment.txt\
                  echo "" >> critical_update_comment.txt\
                  echo "**Critical Issue Protocol:**" >> critical_update_comment.txt\
                  echo "- ðŸš¨ **Priority:** Critical" >> critical_update_comment.txt\
                  echo "- â° **Update Frequency:** Every 24 hours" >> critical_update_comment.txt\
                  echo "- ðŸ“ **Status:** Needs immediate update" >> critical_update_comment.txt\
                  echo "- ðŸ‘¤ **Assignee:** Please provide progress update" >> critical_update_comment.txt\
                  echo "" >> critical_update_comment.txt\
                  echo "**Required Actions:**" >> critical_update_comment.txt\
                  echo "- ðŸ“ **IMMEDIATE UPDATE** with current status" >> critical_update_comment.txt\
                  echo "- ðŸ’¬ **DETAILED COMMENT** on progress made" >> critical_update_comment.txt\
                  echo "- â° **NEXT UPDATE** within 24 hours" >> critical_update_comment.txt\
                  echo "- ðŸ“‹ **DOCUMENT** any blockers or escalations needed" >> critical_update_comment.txt\
                  echo "" >> critical_update_comment.txt\
                  echo "**Critical Issue Management:** Critical issues require daily updates until resolved." >> critical_update_comment.txt\
                  echo "" >> critical_update_comment.txt\
                  echo "**Auto-generated by Issue Feedback System**" >> critical_update_comment.txt' .github/workflows/issue-feedback-system.yml

# Replace assignment_comment heredoc
sed -i '/cat > assignment_comment.txt << '\''EOF'\''/,/^EOF$/c\
                echo "ðŸ‘¤ **Assignment Required** ðŸ‘¤" > assignment_comment.txt\
                echo "" >> assignment_comment.txt\
                echo "This issue has been unassigned for **$hours_since_creation hours**:" >> assignment_comment.txt\
                echo "" >> assignment_comment.txt\
                echo "**Assignment Status:**" >> assignment_comment.txt\
                echo "- ðŸ‘¤ **Assigned:** No" >> assignment_comment.txt\
                echo "- â° **Created:** $hours_since_creation hours ago" >> assignment_comment.txt\
                echo "- ðŸ·ï¸ **Labels:** $labels" >> assignment_comment.txt\
                echo "- ðŸ’¬ **Comments:** $comments" >> assignment_comment.txt\
                echo "" >> assignment_comment.txt\
                echo "**Required Actions:**" >> assignment_comment.txt\
                echo "- ðŸ‘¤ **ASSIGN** to appropriate team member" >> assignment_comment.txt\
                echo "- ðŸ“ **SET PRIORITY** based on issue type" >> assignment_comment.txt\
                echo "- â° **ESTIMATE** resolution timeline" >> assignment_comment.txt\
                echo "- ðŸ“‹ **PLAN** resolution approach" >> assignment_comment.txt\
                echo "" >> assignment_comment.txt\
                echo "**Feedback:** Please assign this issue to ensure it receives proper attention." >> assignment_comment.txt\
                echo "" >> assignment_comment.txt\
                echo "**Auto-generated by Issue Feedback System**" >> assignment_comment.txt' .github/workflows/issue-feedback-system.yml

echo "âœ… issue-feedback-system.yml fixed"

echo "ðŸŽ¯ All heredoc sections have been replaced with echo statements!"
echo "âœ… YAML syntax errors should now be completely resolved!"
echo "ðŸš€ All workflow files should now parse correctly!"
